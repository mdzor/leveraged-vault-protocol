#!/bin/bash

# Pre-push hook to run forge fmt, build, and test checks
# This prevents pipeline failures by running the same checks locally

set -e

echo "ğŸ”¨ Running pre-push checks..."

# Run forge fmt check
echo "ğŸ“ Checking code formatting..."
if ! forge fmt --check; then
    echo "âŒ Code formatting check failed. Run 'forge fmt' to fix formatting issues."
    exit 1
fi
echo "âœ… Code formatting is correct"

# Run forge build
echo "ğŸ—ï¸  Building project..."
if ! forge build --sizes; then
    echo "âŒ Build failed. Fix compilation errors before pushing."
    exit 1
fi
echo "âœ… Build successful"

# Run forge tests
echo "ğŸ§ª Running tests..."
if ! forge test -vvv; then
    echo "âŒ Tests failed. Fix failing tests before pushing."
    exit 1
fi
echo "âœ… All tests passed"

echo "ğŸ‰ All pre-push checks passed! Proceeding with push..."